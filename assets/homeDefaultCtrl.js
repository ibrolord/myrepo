tlbApp.lazy.controller("HomeDefaultController",["$scope","$state","model","global","$timeout","gtmService","dataFactory","modalProvider","cookieHelper","$rootScope","locale","$window",function(e,t,r,n,o,a,i,s,c,d,l,u){var h,g=[];e.recentOrders=void 0,e.$on("$viewContentLoaded",function(t){o(function(){$(".logo-slider").find("a:not(:first-child) img").each(function(t,r){$(r).attr("src",e.model.baseUrl+e.model.hrb[t].rlogo)});var t=$(".search-box-container").offset().top,o=$(".search-box-container").height(),a=t+o;(jQuery(window).width()<768||screen.width<768)&&($(".sliders-section").css("top",a+"px"),0==r.hrb.length&&setTimeout(function(){$(".search-section").addClass("nohrb"),$(".search-section").css("min-height",jQuery(window).height()+"px")},100)),n.customer&&i.getOrderDashboard(n.country.id).then(function(t){e.recentOrders=t.result.orders,_.forEach(e.recentOrders,function(e){_.indexOf([1,2,3],e.eos)>-1&&g.push(e)}),g.length>0&&(h=setInterval(function(){var t=[];_.forEach(g,function(e){t.push(e.oid)}),i.getTrackingStatus({orderIds:t}).then(function(t){var r=t.result;_.forEach(r.osl,function(t){var r=_.find(e.recentOrders,{iid:t.id});r.eos=t.eos,4==t.eos&&(r.ipt=!1),-1==_.indexOf([1,2,3],t.eos)&&_.remove(g,function(e){return e.iid==t.id}),g.length||clearInterval(h)})})},6e4))})},!1)});var f=function(e){var t=new Date;return e.getDate()==t.getDate()&&e.getMonth()==t.getMonth()?!0:void 0};r.showBirthdayBanner=!1,n.customer&&f(new Date(n.customer.birthDate))&&(r.showBirthdayBanner=!0),e.model=r,_.forEach(r.hrb,function(e){a.bannerSliderShown(e.zid,e.rna,e.bna,e.id)}),$(window).width()<768&&(e.ismobile=!0),e.langprefix="en"==r.lang?"/":"/ar/";var m=_.find(r.seoContent.spi,{st:12});m&&m.ex&&(e.aboutArray=m.ex.split("$$")),e.global=n,e.activeBannerSlide=0,e.rotatingBannerClicked=function(e){a.bannerSliderClicked(e.zid,e.rna,e.bna,e.id),t.go("main.infopage",{cnt:n.cnt,restSlug:e.lnk.substring(1)},{location:!0})},e.showRatePopup=function(e,t){a.gtm_rateOrderClicked(e.oid),s.rateOrder(e)},e.orderDetail=function(e,t){s.orderDetail(e)},e.reorder=function(e,t){d.cartmodel&&d.cartmodel.restaurants.length>0?l.ready("common").then(function(){var t=l.getString("common.clearCartWarning",{restname:d.cartmodel.restaurants[0].restName}),r={message:'<div class="p-t-md"><b class="p-y-md f-14 text-center">'+t+"</b></div>",size:"sm",header:!1,footer:!0,okButtonText:l.getString("common.yes"),cancelButtonText:l.getString("common.no"),onOk:function(){p(e)},onCancel:function(){}};s.openDialog(r)}):p(e)};var p=function(e){d.showLoading(),i.getAreasForReorder(e.oid).then(function(r){d.hideLoading();var o=r.result;s.reorder({orderId:e.oid,groupId:null,areaId:e.daid,areaName:e.dan,areas:o},function(r){i.reorder(e.oid,r.areaId,r.branchId?r.branchId:e.bid).then(function(e){if(e.result.status){c.setCart(e.result.cart.gId);var i=_.find(o,{id:parseInt(r.areaId)});i&&c.setArea(i.id,i.an,i.sl);var l=0;_.forEach(e.result.cart.restaurants[0].items,function(e){l+=e.qty}),e.result.cart.restaurants[0].totqty=l,d.cartmodel=e.result.cart,a.gtm_reorderClicked(e.result.cart.restaurants[0].restId),t.go("main.menupage",{cnt:n.cnt,branchid:e.result.cart.restaurants[0].branchId,branchSlug:e.result.cart.restaurants[0].branchSlug,cu:e.result.haschange?1:null})}else s.openDialog({message:'<div class="p-t-md"><b class="p-y-md f-14 text-center">'+e.result.errorMsg+"</b></div>",size:"sm"})})})})};e.showTrackOrder=function(e){a.trackingClicked(),i.getTrackOrderStatus(e.oid).then(function(e){if(e.result.turl){a.trackingWebViewShown();var t=u.open(e.result.turl,"_blank");t?t.focus():window.location=e.result.turl}else a.trackingIntermediateShown(),s.trackOrderNotReadyPopup()})},e.activeSlide=0,e.swiper={},e.next=function(){e.swiper.slideNext()},e.onReadySwiper=function(e){e.on("slideChangeStart",function(){})},e.$on("$destroy",function(){h&&clearInterval(h)})}]);