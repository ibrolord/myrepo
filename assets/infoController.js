tlbApp.lazy.controller("infoController",["$scope","model","filterFilter","$uibModal","$state","cookieHelper","$timeout","gtmService","$window","dataFactory","$rootScope","global","$stateParams","utilityService","modalProvider","$q",function(e,t,r,o,n,i,a,s,c,l,d,u,p,f,m,h){if(e.$on("$viewContentLoaded",function(e){s.gtm_infoLoaded(t.restaurant.id,t.restaurant.rat,t.restaurant.trt,t.restaurant.ius,t.restaurant.na);var r=!1,o=250;setTimeout(function(){$(".noArea").css({transition:"all 0.4s ease-in","-webkit-transition":"all 0.4s ease-in"})},200);var n=function(){jQuery(window).width()<768||screen.width<768?$(".brand-info").css("min-height",jQuery(window).height()-55+"px"):$(".brand-info").css({height:"500px","min-height":"0"})};$(window).on("resize",function(){clearTimeout(r),r=setTimeout(n,o)}),n()}),e.$on("$destroy",function(){$(window).off("resize"),$(".bestselling").off("error")}),t.addresses){var y=[];_.forEach(t.addresses,function(e){var r=_.find(t.areas,function(t){return t.id==e.aid});r&&y.push(e)}),y=y.map(function(e){return e.id=e.aid,e.an=e.an+" ("+e.pn+")",e})}e.isArabic="ar"==u.lng,e.errors={selectAreaError:!1,selectCityError:!1},e.isMobile=$(window).width()<768||screen.width<768,e.toggleWorkingHours=!0;var g=void 0,v=[],A=!1;if(e.selectedBranch=void 0,e.selection={selectedCity:void 0,selectedArea:void 0},e.description=t.restaurant.des,t.country.iscity){var b=i.getCity();if(b)var w=_.find(t.cities,{id:parseInt(b)});Array.prototype.unshift.apply(t.areas,y),g=_.groupBy(t.areas,"cid"),e.currentAreas=w?g[String(b)]:[],e.selection.selectedCity=w?w:void 0}u.restid=t.restaurant.id,t.mostSellingItems=t.mostSellingItems.map(function(e){return e.im?e.enableTooltip=!0:(e.im="item-not-available.svg",e.enableTooltip=!1),e}),e.model=t;var C=function(t){e.model.restaurant=t,e.selection.selectedArea.st=t.st,e.selection.selectedArea.df=t.dch,e.selection.selectedArea.moa=t.mna,e.selection.selectedArea.dtim=t.avd,e.selection.selectedArea.stt=t.stt,e.selection.selectedArea.dty=t.dct,e.selection.selectedArea.hsp=t.hsp};e.groupedAreas=function(e){var o=_.cloneDeep(t.areas),n=r(o,e),i=_(n).groupBy("cid").map(function(e){return e[0].firstInGroup=!0,e}).flatten().value();return y&&y.length&&(y[0].firstInGroup=!0,y[0].cn="en"==u.lng?"My Addresses":"عناويني",Array.prototype.unshift.apply(i,y)),i},e.hideAreatooltip=function(){e.errors.selectAreaError=!1,e.selection.selectedArea||!t.country.iscity||e.selection.selectedCity||(e.errors.selectCityError=!0)},e.hideCitytooltip=function(){e.errors.selectCityError=!1},e.clearArea=function(){e.areaTypeAheadOpen||(e.selection.selectedArea=void 0,e.areaInfoAv=void 0,a(function(){$(".areainput").focus()}))},e.clearCity=function(){e.selection.selectedCity=void 0,e.selection.selectedArea=void 0,e.areaInfoAv=void 0,a(function(){$(".cityInput").focus()})},e.citySelected=function(t,r,o,n){e.selection.selectedCity=t,e.currentAreas=g[String(t.id)],setTimeout(function(){$(".areainput").focus()},10),e.errors.selectAreaError=!1},e.areaSelected=function(t){s.gtm_areaSelection(t.id),setTimeout(function(){$(".areainput").blur()},50),d.showLoading();var r=[];r.push(l.getAreaInfoForRest(p.cnt,p.restSlug,t.id)),e.model.restaurant.gid&&r.push(l.getFranchiseList(t.id,e.model.restaurant.gid)),h.all(r).then(function(t){e.selection.selectedArea=t[0].areas[0],e.areaInfoAv=!0,t[1]&&t[1].length>0&&1==t[1].length?(A=!0,C(t[1][0])):t[1]&&(v=t[1],e.openBranchpopup(t[1])),d.hideLoading(),s.brandDetailsInfoLoaded(e.model.restaurant,e.selection.selectedArea,t[1]?t[1].length:0)},function(e){d.hideLoading()})};var I=i.getArea();I&&(cookieAreaObj=_.find(t.areas,{id:parseInt(I)}),cookieAreaObj&&(e.selection.selectedArea=cookieAreaObj,e.areaSelected(cookieAreaObj))),e.openBranchpopup=function(t){var r=o.open({animation:!1,backdrop:"static",keyboard:!1,templateUrl:"franchiseModal.html",controller:"franchiseModalController",size:"sm",windowClass:"branchModal",resolve:{model:function(){return t||v}}});r.result.then(function(t){A=!0,e.selectedBranch=t.bna,C(t)},function(){})},e.changeTooltipImage=function(t){e.tooltipImage=t},e.showItemImage=function(e,t){if(e.stopPropagation(),!(t.indexOf("item-not")>-1)){o.open({animation:!0,templateUrl:"showItemImage.html",controller:"showImgCtrl",resolve:{img:function(){return t}}})}},e.postfb=function(){FB.ui({method:"feed",name:t.restaurant.na+" "+t.country.na+" | "+t.restaurant.na+" Menu | Online Delivery | Talabat.com",link:window.location.href,picture:t.baseUrl+"/restaurants/"+t.restaurant.lg,caption:"",description:t.restaurant.des,message:""})},e.postTwitter=function(){var e="https://www.twitter.com/intent/tweet?";e+="text="+encodeURIComponent(t.restaurant.na+" "+t.country.na+" | "+t.restaurant.na+" Menu | Online Delivery | Talabat.com"),e+="&via="+encodeURIComponent("talabat"),e+="&url="+encodeURIComponent(window.location.href),c.open(e,"sharer","toolbar=0,status=0,width=500,height=600,top="+(c.innerHeight-600)/2+",left="+(c.innerWidth-500)/2)},e.scrollToRev=function(e){f.scrollTo(e)};var S=2;e.readMore=t.reviews.tr>0,e.loadMore=function(){l.getRestReviews(t.restaurant.id,S).then(function(t){t.tr?(e.model.reviews.rev=e.model.reviews.rev.concat(t.rev),S<t.pg?S++:e.readMore=!1):e.readMore=!1})};var M;e.resetSelection=function(t){switch(M){case 1:e.selection.selectedArea=void 0,e.citySelected(t);break;case 2:e.selection.selectedArea=t,e.areaSelected(t)}},e.mobilePopup=function(r){if(2==r&&e.model.country.iscity&&!e.selection.selectedCity)return void(e.errors.selectCityError=!0);var o;switch(M=r,e.errors.selectCityError=!1,e.errors.selectAreaError=!1,r){case 1:o=e.model.cities;break;case 2:o=t.country.iscity?e.currentAreas:e.groupedAreas()}m.selectionPopup(r,o,e.resetSelection)},e.gotoMenu=function(){if(e.selection.selectedArea){i.setArea(e.selection.selectedArea.id,e.selection.selectedArea.an,e.selection.selectedArea.sl);try{t.country.iscity&&e.selection.selectedCity&&i.setCity(e.selection.selectedCity.id)}catch(r){}var o;o=A?e.model.restaurant.bid:e.selection.selectedArea.bid,n.go("main.menupage",{cnt:t.country.sl,branchid:o,branchSlug:e.selection.selectedArea.sl})}else t.country.iscity&&!e.selection.selectedCity?e.errors.selectCityError=!0:e.errors.selectAreaError=!0}}]),tlbApp.lazy.controller("showImgCtrl",["$scope","img","global",function(e,t,r){e.imgName=t,e.baseUrl=r.baseUrl}]),tlbApp.lazy.controller("franchiseModalController",["$scope","$uibModalInstance","model","$timeout",function(e,t,r,o){e.model=r,e.cancel=function(){t.dismiss("")},e.branchSelected=function(e){t.close(e)},e.clearBranch=function(){e.branchTypeAheadOpen||(e.selectedBranch=void 0,setTimeout(function(){$(".branchinput").focus()},10))}}]),tlbApp.lazy.controller("selectionPopupCtrl",["$scope","$uibModalInstance","$timeout","type","data","global",function(e,t,r,o,n,i){$("html").addClass("noscroll-long noscroll"),e.data=n,e.isgroupedArea=!i.country.iscity&&2==o,e.selectType=o,e.filterProp=function(){return 2==o?{an:e.optionSearch}:{na:e.optionSearch}};var a=30,s=0;e.loadMore=function(){var t=e.data.length,o=Math.ceil(t/a);o>s&&(s++,e.currentSize=s*a,r(function(){_.delay(e.loadMore,50)}))},e.loadMore(),e.cancel=function(){t.dismiss()},e.optionSelected=function(e){t.close(e)},e.clearOptionSearchText=function(){e.optionSearch=""},e.$on("$destroy",function(){$("html").removeClass("noscroll-long noscroll")})}]);