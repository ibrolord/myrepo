tlbApp.lazy.controller("AllRestaurantsController",["$scope","$state","model","filterFilter","global","cookieHelper","$timeout","gtmService","modalProvider","dataFactory","$rootScope","$stateParams",function(e,t,r,i,s,n,o,c,a,l,d,u){"main.allCuisineRestaurants"==t.current.name&&(e.allCuis=!0);var p=[{id:0,na:"en"==s.lng?"All Cuisines":"جميع المطابخ",sl:"all"}];if(Array.prototype.unshift.apply(r.cuisines,p),e.model=r,e.global=s,e.errors={selectAreaError:!1,selectCityError:!1},r.addresses)var f=r.addresses.map(function(e){return e.id=e.aid,e.an=e.an+" ("+e.pn+")",e});var y=_.find(r.seoContent.spi,{st:13});y&&y.ex&&(e.h1Text=y.ex),$(window).width()<768?(e.ismobile=!0,e.bgimage="url(/images/talabat/mobile-bg.jpg)"):e.bgimage="#000 url("+r.baseUrl+r.seoContent.bi[0].nm+") no-repeat top";var m,A=null,C=!1;r.fromServerSide&&r.landingBanner&&!n.getHomePagePopup()&&!s.adblockEnabled&&a.bannerAdPopup("home",function(){n.setHomePagePopup()});var g=function(){var e=_.cloneDeep(r.areas),t=_(e).groupBy("cid").map(function(e){return e[0].firstInGroup=!0,e}).flatten().value();return f&&f.length&&(f[0].firstInGroup=!0,f[0].cn="en"==s.lng?"My Addresses":"عناويني",Array.prototype.unshift.apply(t,f)),t};if(r.country.iscity){var v=n.getCity();if(v)var h=_.find(e.model.cities,{id:parseInt(v)});Array.prototype.unshift.apply(r.areas,f);var b=_.groupBy(r.areas,"cid");e.currentAreas=h?b[String(v)]:[],e.clearCity=function(){e.selection.selectedCity=void 0,e.selection.selectedArea=void 0,o(function(){$(".cityInput").focus()})},e.citySelected=function(t,r,i,s){e.selection.selectedCity=t,e.currentAreas=b[String(t.id)],setTimeout(function(){$(".areainput").focus()},10),e.errors.selectAreaError=!1},e.hideCitytooltip=function(){e.errors.selectCityError=!1}}else e.groupedAreas=g();e.areaSelected=function(t){c.gtm_areaSelection(t.id),m&&m.abort(),(m=l.prefetchList(t.id,s.country.sl)).then(function(t){window.prefetchedList=t,clearTimeout(A),m=null,C?(C=!1,e.findRestaurants()):A=setTimeout(function(){window.prefetchedList=null},12e4)},function(e){console.info("Error:",e)})};var S,E=void 0;if(S=n.getArea(),S&&(E=_.find(e.model.areas,{id:parseInt(S)}),e.areaSelected({id:parseInt(S)})),s.customer){var w=n.getCustomerAddress();if(w){var I=_.find(f,{eid:w});I&&(E=I)}}e.selection={selectedCity:h?h:void 0,selectedArea:E?E:void 0,selectedCuisine:void 0},e.hideAreatooltip=function(){e.errors.selectAreaError=!1,e.selection.selectedArea||!r.country.iscity||e.selection.selectedCity||(e.errors.selectCityError=!0)},e.clearArea=function(){!e.selection.selectedCity&&r.country.iscity?e.errors.selectCityError=!0:e.areaTypeAheadOpen||(e.selection.selectedArea=void 0,o(function(){$(".areainput").focus()}))},e.clearCuisine=function(){e.cuisineTypeAheadOpen||(e.selection.selectedCuisine=void 0,o(function(){$(".cuisinesInput").focus()}))},e.cuisineSelected=function(t){c.gtm_cuisineSelection(e.selection.selectedCuisine.sl)},e.homeBannerClicked=function(e){"banner-home"==e.target.id&&r.seoContent.bi[0].rid&&t.go("main.infopage",{cnt:r.country.sl,restSlug:r.seoContent.bi[0].sl})};var x;if(e.resetSelection=function(t){switch(x){case 1:e.selection.selectedArea=void 0,e.citySelected(t);break;case 2:e.selection.selectedArea=t,e.areaSelected(t);break;case 3:e.selection.selectedCuisine=t,e.cuisineSelected(t)}},e.mobilePopup=function(t){if(2==t&&e.model.country.iscity&&!e.selection.selectedCity)return void(e.errors.selectCityError=!0);var i;switch(x=t,e.errors.selectCityError=!1,e.errors.selectAreaError=!1,t){case 1:i=e.model.cities;break;case 2:i=r.country.iscity?e.currentAreas:e.groupedAreas;break;case 3:i=e.model.cuisines}a.selectionPopup(t,i,e.resetSelection)},e.findRestaurants=function(){m?(C=!0,d.showLoading()):e.selection.selectedArea?(c.gtm_addresssub(e.selection.selectedArea.id,e.selection.selectedCity,s.country),n.setArea(e.selection.selectedArea.id,e.selection.selectedArea.an,e.selection.selectedArea.sl),r.country.iscity&&n.setCity(e.selection.selectedCity.id),s.customer&&e.selection.selectedArea.eid&&n.setCustomerAddress(e.selection.selectedArea.eid),e.selection.selectedCuisine&&e.selection.selectedCuisine.id?t.go("main.restaurantList",{cnt:r.country.sl,areaId:e.selection.selectedArea.id,areaSlug:e.selection.selectedArea.sl,cuisinetype:e.selection.selectedCuisine.id+"-"+e.selection.selectedCuisine.na}):t.go("main.restaurantList",{cnt:r.country.sl,areaId:e.selection.selectedArea.id,areaSlug:e.selection.selectedArea.sl})):r.country.iscity&&!e.selection.selectedCity?e.errors.selectCityError=!0:e.errors.selectAreaError=!0},e.$on("$destroy",function(){clearTimeout(A)}),e.langprefix="en"==s.lng?"/":"/ar/",e.isNew="new"==u.t?!0:!1,e.clearSearch=function(){e.restSearch=""},u.cuisineId){var P=_.find(r.seoContent.spi,{st:15});P&&P.ex&&(e.h3text=P.ex);var k=_.find(r.seoContent.spi,{st:12});k&&k.ex&&(e.description=k.ex)}var T=30,L=0;e.currentSize=T,e.loadMore=function(){var t=e.model.restaurants.length,r=Math.ceil(t/T);r>L&&(L++,e.currentSize=L*T)}}]);